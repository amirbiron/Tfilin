# ×§×•×‘×¥ ×”×’×“×¨×•×ª Render ××ª×§×“× ×œ×‘×•×˜ ×ª×¤×™×œ×™×Ÿ
# ×××¤×©×¨ deployment ××•×˜×•××˜×™ ×•××ª×§×“× ×‘-Render

databases:
  # ××•×¤×¦×™×•× ×œ×™ - ×× ×¨×•×¦×™× Redis ×œcaching
  - name: tefillin-redis
    databaseName: tefillin_cache
    user: redis_user
    plan: starter  # Redis ×—×™× ××™

services:
  # ×”×©×™×¨×•×ª ×”×¨××©×™ - ×”×‘×•×˜
  - type: web
    name: tefillin-bot
    runtime: docker
    
    # ××™×“×¢ ×¢×œ ×”-repository
    repo: https://github.com/yourusername/tefillin-bot.git
    branch: main
    
    # ×¤×§×•×“×•×ª build ×•-start
    dockerfilePath: ./Dockerfile
    dockerContext: ./
    
    # ×”×’×“×¨×•×ª instance
    plan: starter  # ×ª×•×›× ×™×ª ×‘×¡×™×¡×™×ª (×—×™× ××™×ª)
    region: oregon  # ××–×•×¨ ×©×¨×ª (oregon ×–×•×œ ×™×•×ª×¨)
    
    # ×¤×§×•×“×•×ª
    buildCommand: ""  # Docker ×™×˜×¤×œ ×‘×‘× ×™×™×”
    startCommand: "/app/start.sh"  # ××©×ª××© ×‘×¡×§×¨×™×¤×˜ ×”×”×¤×¢×œ×”
    
    # ×‘×“×™×§×•×ª ×ª×§×™× ×•×ª
    healthCheckPath: "/health"  # Health check endpoint
    
    # Auto-deploy
    autoDeploy: true  # deployment ××•×˜×•××˜×™ ×¢× git push
    
    # ××©×ª× ×™ ×¡×‘×™×‘×” (×”×’×“×¨ ×‘×××©×§ Render)
    envVars:
      - key: BOT_TOKEN
        sync: false  # ×œ× ×œ×©×ª×£ ×¢× services ××—×¨×™×
      - key: MONGODB_URI
        sync: false
      - key: LOG_LEVEL
        value: INFO
      - key: DEFAULT_TIMEZONE
        value: Asia/Jerusalem
      - key: PYTHONUNBUFFERED
        value: "1"
      - key: PYTHONPATH
        value: "/opt/render/project/src"
      - key: PORT
        value: "10000"
    
    # ×”×’×“×¨×•×ª networking
    domains:
      - tefillin-bot.onrender.com  # ×“×•××™×™×Ÿ ××•×˜×•××˜×™
    
    # ×”×’×“×¨×•×ª disk ×•-memory
    disk:
      name: tefillin-data
      mountPath: /data
      sizeGB: 1  # 1GB storage ×—×™× ××™
    
    # Scaling (×œ×ª×•×›× ×™×•×ª ×‘×ª×©×œ×•×)
    scaling:
      minInstances: 1
      maxInstances: 1
    
    # Environment ×•-notifications
    notificationOverride: email  # ×”×ª×¨××•×ª ×‘××™×™×œ
    
    # Pre-deploy hooks (××•×¤×¦×™×•× ×œ×™)
    preDeployCommand: |
      echo "ğŸš€ Starting deployment..."
      echo "Validating environment variables..."
      
    # Post-deploy hooks (××•×¤×¦×™×•× ×œ×™)  
    postDeployCommand: |
      echo "âœ… Deployment completed successfully!"
      echo "Bot should be running now"

  # ×©×™×¨×•×ª × ×•×¡×£ - dashboard ×œ× ×™×˜×•×¨ (××•×¤×¦×™×•× ×œ×™)
  - type: web
    name: tefillin-dashboard
    runtime: python
    
    # ×× ×™×© dashboard × ×¤×¨×“
    repo: https://github.com/yourusername/tefillin-dashboard.git
    branch: main
    
    buildCommand: pip install -r requirements.txt
    startCommand: python dashboard.py
    
    plan: starter
    
    envVars:
      - key: MONGODB_URI
        fromService:
          type: web
          name: tefillin-bot
          envVarKey: MONGODB_URI
      - key: DASHBOARD_SECRET
        generateValue: true  # ×™×¦×™×¨×ª ×¡×™×¡××” ××•×˜×•××˜×™×ª

# ×”×’×“×¨×•×ª ×›×œ×œ×™×•×ª
# Preview environments - ×¢×‘×•×¨ testing
previewsEnabled: true
previewsExpireAfterDays: 7

# Branch deploys
branchDeploys:
  enabled: true
  autoPreviewsEnabled: true

# Notifications
notifications:
  - type: email
    emails:
      - your.email@example.com
    events:
      - deploy-started
      - deploy-succeeded  
      - deploy-failed
      - service-suspended

  # ××•×¤×¦×™×•× ×œ×™ - ×”×ª×¨××•×ª ×œ×˜×œ×’×¨×
  - type: webhook
    url: https://api.telegram.org/botYOUR_BOT_TOKEN/sendMessage
    events:
      - deploy-failed
    headers:
      Content-Type: application/json
    payload: |
      {
        "chat_id": "YOUR_CHAT_ID",
        "text": "ğŸš¨ Deployment failed for tefillin-bot: {{ service.name }}"
      }

---
# ×”×¢×¨×•×ª ×•×©×™××•×©:

# 1. ×”×¤×¢×œ×”:
#    - ×”×¢×œ×” ××ª ×”×§×•×‘×¥ ×”×–×” ×œ×©×•×¨×© ×”×¤×¨×•×™×§×˜
#    - Render ×™×–×”×” ×•×™×˜×¤×œ ×‘×›×œ ××•×˜×•××˜×™×ª
#    - × ×™×ª×Ÿ ×’× ×œ×”×’×“×™×¨ ×™×“× ×™×ª ×‘×××©×§

# 2. ××©×ª× ×™ ×¡×‘×™×‘×”:
#    BOT_TOKEN - ×˜×•×§×Ÿ ×”×‘×•×˜ (×—×•×‘×”!)
#    MONGODB_URI - ×›×ª×•×‘×ª MongoDB (×—×•×‘×”!)
#    LOG_LEVEL - ×¨××ª ×œ×•×’×™× (INFO)
#    DEFAULT_TIMEZONE - ××–×•×¨ ×–××Ÿ (Asia/Jerusalem)

# 3. ×ª×•×›× ×™×•×ª:
#    starter - ×—×™× ××™, ××•×’×‘×œ
#    standard - $7/×—×•×“×©, ×™×•×ª×¨ ×–×›×¨×•×Ÿ
#    pro - $25/×—×•×“×©, ×‘×™×¦×•×¢×™× ×’×‘×•×”×™×

# 4. ××–×•×¨×™ ×©×¨×ª:
#    oregon - ×–×•×œ ×™×•×ª×¨
#    virginia - ××”×™×¨ ×™×•×ª×¨ ×œ×™×©×¨××œ
#    frankfurt - ×”×›×™ ××”×™×¨ ×œ×™×©×¨××œ (×‘×ª×©×œ×•×)

# 5. Auto-deploy:
#    ×›×œ push ×œ-main ×™×’×¨×•× ×œdeploy ××•×˜×•××˜×™
#    Preview environments ×¢×‘×•×¨ feature branches

# 6. Monitoring:
#    Render ××¡×¤×§ ×œ×•×’×™× ×•××“×“×™× ×‘×¡×™×¡×™×™×
#    ×¢×‘×•×¨ monitoring ××ª×§×“× - ×”×©×ª××© ×‘×©×™×¨×•×ª ×—×™×¦×•× ×™

# 7. Scaling:
#    ×‘×ª×•×›× ×™×ª ×”×—×™× ××™×ª - instance ××—×“ ×‘×œ×‘×“
#    ×‘×ª×•×›× ×™×•×ª ×‘×ª×©×œ×•× - auto-scaling

# 8. Storage:
#    1GB ×—×™× ××™
#    ×œ× × ×“×¨×© ×œ×‘×•×˜ telegram ×¤×©×•×˜

# 9. Secrets:
#    ×”×©×ª××© ×‘-environment variables ×‘-UI ×©×œ Render
#    ××œ ×ª×©×™× ×¡×•×“×•×ª ×‘×§×•×‘×¥ yaml

# 10. Troubleshooting:
#     ×¦×¤×” ×‘×œ×•×’×™× ×‘×–××Ÿ ×××ª: render logs --tail
#     ×‘×“×•×§ health checks ×× ×”×•×’×“×¨×•
#     ×•×•×“× ×©×›×œ ××©×ª× ×™ ×”×¡×‘×™×‘×” ××•×’×“×¨×™×

# ×“×•×’××ª ×¤×§×•×“×•×ª CLI:
# render login
# render deploy --service tefillin-bot
# render logs --service tefillin-bot --tail
# render env set BOT_TOKEN=your_token --service tefillin-bot
